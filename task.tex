\section{Постановка задачи}

\subsection{Формальная постановка задачи}



\subsection{Требования к анализатору}

К решению задачи предъявляется следующий набор требований, связанных с 
возможными способами прикладного применения анализатора.

\begin{itemize}
 \item Простота: описание конфигурации анализатора должно быть простым для 
понимания, создания и редактирования как вручную пользователем анализатора, так 
и с применением программного обеспечения для автоматического составления 
описания протоколов.
 \item Совместимость: формат описания конфигурации анализатора должен быть 
совместимым с 
используемым на текущий момент форматом описания протокола для Анализатора 
МКИО для возможности переиспользования существующего программного обеспечения 
для автоматического составления описания протоколов.
 \item Быстродействие: анализатор должен иметь возможность выполняться 
достаточно быстро для работы в режиме регистрации обменов в реальном времени при 
условии выполнении анализа на рабочей станции пользователя Анализатора МКИО и 
проверки достаточно большого количества требований.
 \item Расширяемость: анализатор должен быть готовым к возможным расширениям 
% функционала (определению новых типов требований к обменам и параметрам) с 
сохранением совместимости с предыдущей версией как минимум на уровне формата 
описания конфигурации. Это значит, что при добавлении новых типов ограничений 
пользователь должен иметь возможность использовать описания требований, 
использованных с предыдущей версией анализатора (возможно, с незначительными 
строго описанными изменениями).
\end{itemize}

В качестве дополнительного требования, для удобства работы описание 
конфигурации анализатора требований должно иметь возможность сохранения во 
внутреннем пользовательском хранилище Анализатора МКИО для последующего 
переиспользования без необходимости повторного импорта описания из внешнего 
файла.

\iffalse
\subsection{Неформальная постановка задачи}

Целью работы является разработка методов и программных средств для 
анализа трасс данных обменов по МКИО с учётом заранее определённых требований. 
Примеры возможных требований:

\begin{itemize}
 \item асинхронность сообщения, либо частота появления сообщения;
 \item соответствие контрольных сумм;
 \item гладкость передаваемого значения (ограничение на скорость изменения 
значения);
 \item автоматичеcкое увеличение (автоинкремент) передаваемого значения во 
времени
\end{itemize}

Трасса состоит из слов (?) с признаками КС, ОС или СД. Из последовательности 
слов согласно одному из 10 шаблонов, приведённых в ГОСТ Р 52070-2003, 
составляются обмены, для которых выделяется набор полей:

\begin{itemize}
 \item время начала обмена;
 \item продолжительность обмена;
 \item формат обмена - номер шаблона из ГОСТ Р 52070-2003
 \item адрес и подадрес абонента-отправителя и абонента-получателя (отдельно 
определяется фиктивный адрес КШ, так как он может не иметь реального адреса на 
шине);
 \item количество слов данных, переданных в рамках обмена;
 \item признак и тип ошибки, произошедшей при выполнении обмена;
 \item переданные данные.
\end{itemize}

Анализатору сообщается набор требований к конкретным сообщениям. 
Допускается также, что МКИО может функционировать в нескольких различных 
режимах, при этом для каждого режима формируется свой набор требований и 
условия переходов из одного режима в другой.

\subsection{Определения и обозначения}

% Определения взяты из дипломной работы Гордеева (2008) с некоторыми 
% изменениями и добавлениями

\textbf{Обмен} - ($M = <t, d, f, a_{src}, a_{dst}, s_{src}, s_{dst}, sz, e, p 
>$) - атомарный завершённый обмен информацией между абонентами канала МКИО, в 
соответствии с протоколом обмена по ГОСТ Р 52070-2003 
[\ref{gost_r_52070-2003}]. Понятие обмена соответствует термину 
\textit{сообщение} ГОСТ. С точки зрения анализа последовательностей обменов, 
каждый обмен характеризуется следующими атрибутами:

\begin{itemize}
 \item $t$ - время начала обмена (мкс);
 \item $d$ - продолжительность обмена (мкс);
 \item $f$ - формат (тип) обмена по ГОСТ Р 52070-2003 - целое число в интервале 
$[1, 10]$;
 \item $a_{src}, a_{dst}$ - адреса абонента-отправителя и абонента-получателя 
данных в рамках обмена - целые числа на отрезке $[0, 32]$ ($[0, 31]$ - 
допустимое множество адресов для МКИО, $32$ - фиктивный адрес КШ (контроллера 
шины);
 \item $s_{src}, s_{dst}$ - подадреса абонента-отправителя и 
абонента-получателя данных в рамках обмена - целые числа на отрезке $[1, 31]$;
 \item $sz$ - количество слов данных, передаваемых в сообщении - целое число на 
отрезке $[0, 31]$;
 \item $e$ - признаки обмена - подмножество множества $E$, 
соответствующего набору признаков, передаваемых в ОС:
 \begin{itemize}
  \item $Err$ - ``Ошибка в сообщении'' - признак достоверности принятых данных;
  \item $Mntn$ - ``Запрос на обслуживание'' - требование ОУ или связанного с 
ним абонента (абонентов) на обслуживание;
  \item $Grp$ - ``Принята групповая команда'' - указывает на приём ОУ 
достоверной групповой команды;
  \item $Busy$ - ``Абонент занят'' - состояние занятости ОУ или интерфейса 
абонента, которое может повлиять на обмен информацией по каналу;
  \item $Aflt$ - ``Неисправность абонента'' - техническое состояние абонента, 
связанного с ОУ;
  \item $Eflt$ - ``Неисправность ОУ'' - техническое состояние ОУ;
 \end{itemize}
 \item $p$ - полезная нагрузка (переданные данные в СД) - последовательность 
слов длины $M_sz$.
\end{itemize}

Атрибуты сообщения $M$ обозначаются так: $M_t$, $M_d$, ..., $M_{a_{src}}$, ..., 
$M_p$. Дополнительно используются обозначения границ интервалов времени 
$M_{start} = M_t$, $M_{end} = M_{start} + M_d$ и обозначение продолжительности 
обмена $|M| = M_d$. Если в названии сообщения используются индексы (например, 
$M^i$), то атрибуты обозначаются так: $M^i_t$, $M^i_d$, ..., 
$M^i_{a_{src}}$, $M^i_p$.


% TODO: обсудить момент форматизации контрольной суммы, где она появляется и 
% т.д.

Дополнительно в сообщении $M$ может передаваться его контрольная сумма, 
значение которой будем в дальнейшем обозначать $M_{ch}$.

\textbf{Экземпляр обмена} - совокупность $M$ значений всех атрибутов обмена. 
Экземпляр обмена характеризуется типом $Type(M)$, временем начала $M_t$, 
продолжительностью $M_d$, признаками $M_e$ и полезной нагрузкой $M_p$.

\textbf{Тип обмена} ($T = Type(M)$) - совокупность значений атрибута обмена 
$<f, a_{src}, a_{dst}, s_{src}, s_{dst}, sz>$. Каждый экземпляр обмена, таким 
образом, соответствует одному и только одному типу данных.

\textbf{Трасса обменов} $T = \{  M^1, M^2, ..., M^n \} : M^i_{end} \leq 
M^{i+1}_{start} \forall i = \overline{1,n-1}$ - конечная последовательность 
обменов. Время начала обменов $M^i_t$ отсчитывается относительно момента начала 
записи трассы обмена.

% TODO: Надо как-то назвать задаваемую последовательность обменов...

\textbf{Описание цепочки обменов} $D$ - конечный автомат, множеством состояний 
и входным алфавитом которого является подмножество множества типов обмена. 
Определяя это множество, а также начальное состояние, множество конечных 
состояний и функцию перехода, пользователь определяет логически связанные 
последовательности обменов в трассе.

\textbf{Цепочка обменов} $C$ - логически связанная последовательность обменов 
в трассе (не обязательно непосредственно следующих друг за другом), 
определяемая описанием цепочки $D$.

В дальнейшем будем пользоваться следующим обозначением: описанию цепочки $D_i$ 
в трассе $T$ соответствует последовательность цепочек $C_i = \{ C_i^1, ..., 
C_i^k \}$.

% TODO: Здесь тоже корявое название

\textbf{Функция корректности последовательности цепочек} $R$ - функция $R: 
{C^1, ..., C^q} \rightarrow \{ 1, 0 \}$, определяющее корректность входной 
последовательности цепочек, т. е. $R(C) = 1 \Leftrightarrow C$ - корректная 
последовательность цепочек. Требования корректности определяются пользователем 
для проверки непосредственно передаваемых данных, в том числе с учётом 
типов, порядка и времени их передачи.

\subsection{Формальная постановка задачи}

\textbf{Исходные данные}: зарегистрированная трасса обменов на канале МКИО $T = 
\{ M^1, ..., M^n \}$, множество описаний цепочек $D = \{ D_1, ..., D_m \}$ и 
функция корректности последовательностей цепочек $R$.

\textbf{Требуется}: разработать набор алгоритмов и реализовать программные 
средства, обеспечивающие решение следующих задач:

\begin{itemize}
 \item поиск цепочек $C_i$ в трассе $T$ согласно 
описаниям цепочек $D_i$;
 \item вычисление статистических характеристик цепочек обменов $C_i$:
 \begin{itemize}
  \item частота появления цепочек $f_i$;
 \end{itemize}
 \item проверка корректности последовательностей цепочек $C_i$ с помощью 
функции $R$.

\end{itemize}

\subsection{Уточнение исходных данных}

\subsubsection{Режимы работы системы}

Множество описаний цепочек делится дополнительно на подмножества, образующие 
\textit{режимы} работы анализируемой системы. Дополнительно к каждому описанию 
цепочки дописывается поле, содержащее новое значение режима работы (в том 
случае, если появление данной цепочки это подразумевает).

\subsubsection{Функция корректности последовательности цепочки}

Для упрощения задачи полезно уточнить определение функции корректности 
последовательности так, чтобы она требовала меньше входных данных с сохранением 
всех свойств.

Введём дополнительно определение \textbf{подцепочки} $\hat{C}^t_k$ цепочки $C = 
\{M^1, ..., M^n\}$ длительности $t$ как максимальной подпоследовательности 
последовательности $\{M^j\}^{j=k}_{k+p}$, где время между началом первого и 
последнего сообщения не превышает $t$: $M^{k+p}_{start} - M^k_{start} \leq t$. 
Требование максимальности необходимо для попадания в подцепочку всех обменов на 
отрезке времени $[M^k_{start}, M^k_{start}+ t]$.

Считается, что функция проверки корректности $R$ может быть одной из 
нижеперечисленных, определённых на соответствующих множествах обменов, 
имеющих требуемые в формулировках атрибуты:

\begin{itemize}
 \item $R_p(M^i, M^{i+1}, f_{Type(M)})$ - функция, проверяющая асинхронность 
сообщения, либо соответствие реальной частоты появления обмена $M$ заранее 
заданной $f_{Type(M)}$: $R_p(M^i, M^{i+1}, f_{Type(M)}) = 1 \Leftrightarrow 
(f_{Type(M)} = 0) \vee (M^{i+1}_{start} - M^i_{start} \geq 
{f_{Type(M)}}^{-1}, f_{Type(M)} > 0)$. $R_p$ определена на множестве всех 
обменов;

 \item $R_c(M^i)$ - функция, устанавливающая соответствие подсчитанной 
контрольной суммы тела обмена и переданной в обмене: $R_c(M) = 1 
\Leftrightarrow checksum(M^i) = M^i_{ch}$. $R_c$ определена на множестве 
обменов, имеющих атрибут $M_{ch}$;

% TODO: с этим товарищем всё не так гладко, нужно определить длину 
% или длительность последовательности обменов одного типа
 \item $R_{ai}(\hat{C}^i_{t_{Type(M)}})$ - функция, определяющая 
автоматичеcкое увеличение (автоинкремент) передаваемого значения во 
времени не реже, чем каждый интервал времени длительности $t_{Type(M)}$: 
$R_{ai}(\hat{C}^i_{t_{Type(M)}}) = 1 \Leftrightarrow (M^{i+p}_{start} - 
M^i_{start} > t_{Type(M)}) \wedge (M^{i+p}_{ai} - M^i_{ai} > 0)$, где $p$ - 
длина подцепочки $\hat{C}^i$, $M^j_v$ - заранее определённый увеличиваемый 
атрибут обмена. $R_{ai}$ определена на множестве обменов, имеющих атрибут 
$M_{ai}$.
\end{itemize}

Константы $f_{Type(M)}$ и $t_{Type(M)}$ можно занести внутрь функций $R$. Также 
стоит расширить функции $R_c$ и $R_{ai}$ на множество всех возможных обменов, 
доопределив их значением 1. Таким образом, мы получаем функции 
$R^{Type(M)}_p(M^{i}, M^{i+1})$, $R^{Type(M)}_c(M)$, $R^{Type(M)}_{ai}(M)$

Наличие атрибутов $M_{ch}$ и $M_{ai}$ определяется типом сообщения $M$.

Таким образом, в общем случае функция обмена существенно зависит от:

\begin{itemize}
 \item типа обрабатываемого обмена $Type(M)$;
 \item одного обмена, или двух обменов, или подцепочки обменов длительности $t$,
\end{itemize}

что упрощает описание множества определения функции $R$.

% далее следует немного треша aka выписки и мысли вслух
\newpage
\fi

\iffalse

\begin{enumerate}
 \item КС - СД - СД - ... - СД - [t] - ОС - формат 1
 \item КС - [t] - ОС - СД - СД - ... - СД - формат 2
 \item КС - КС - [t] - ОС - СД - ... - СД - [t] - ОС - формат 3
 \item КС - [t] - ОС - формат 4
 \item КС - [t] - ОС - СД - формат 5
 \item КС - СД - [t] - ОС - формат 6
 \item КС - СД - ... - СД - формат 7 (групповой здесь и далее)
 \item КС - КС - [t] - ОС - СД - ... - СД - формат 8
 \item КС - формат 9
 \item КС - СД - формат 10
\end{enumerate}

Каждая последовательность может содержать не более 32 слов данных.

Каждая из вышепредложенных последовательностей соответствует своему формату сообщения:

\begin{enumerate}
 \item Формат 1 - передача данных от контроллера шины (КШ) к оконечному устройству (ОУ)
 \item Формат 2 - передача данных от ОУ к КШ
 \item Формат 3 - передача данных от ОУ к ОУ
 \item Формат 4 - передача команды управления (КУ)
 \item Формат 5 - передача КУ и приём СД от ОУ
 \item Формат 6 - передача КУ с СД оконечному устройству
 \item Формат 7 - передача данных от КШ к оконечным устройствам
 \item Формат 8 - передача данных от ОУ оконечным устройствам
 \item Формат 9 - передача КУ группе ОУ
 \item Формат 10 - передача КУ с СД группе ОУ
\end{enumerate}

Считаем, что КШ на линии один и не меняется.
\fi