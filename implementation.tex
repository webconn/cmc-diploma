\section{Описание реализации}

В данном разделе приводится краткое описание реализации решения на языке С++ с 
использованием возможностей инструментария Qt и его библиотеки для языка С++, а 
также с использованием инструментария, реализованного в рамках tabexchange.

\subsection{Внутреннее представление ограничения}

В качестве внутреннего представления отдельных ограничений используются 
специальные структуры: 

\begin{itemize}
 \item ExchangeRestrictDescription,
 \item ParamRestrictDescription,
\end{itemize}

наследующие тип RescrictDescription. Структуры содержат поля для хранения 
информации согласно описанию внутреннего представления (см. 
раздел~\ref{subsec:inner}) с дополнительным полем для идентификатора объекта - 
текстового идентификатора обмена (параметра). Это нужно для того, чтобы 
избавить фабрику обработчиков от необходимости взаимодействовать с полной 
иерархией объектов хранилища конфигурации анализатора.

Дополнительно в рамках этих структур реализованы методы для сохранения и 
загрузки полей из контейнера QSettings, а также метод для загрузки 
значений полей при импорте XML-описания протокола.

Структуры определены в файлах tabexchange/analyzercore.[h|cpp].

\subsection{Контейнеры для описания ограничений}

Для хранения внутреннего представления описания ограничений были реализованы 
контейнеры
\begin{itemize}
 \item ExchangeRestrictionContainer,
 \item ParamRestrictionContainer.
\end{itemize}

Контейнеры реализованы на базе класса NamedObjectContainer, используемого в 
tabexchange для создания контейнеров для именованных объектов с возможностью 
добавления, использования, редактирования (с оповещением классов-пользователей 
контейнера) элементов, а также автоматического сохранения содержимого 
контейнера в пользовательский репозиторий Анализатора МКИО и последующей 
загрузки.

Именами в контейнерах служат текстовые идентификаторы: для обменов - 
идентификаторы сообщений, совпадающие с таковыми в контейнере описаний 
сообщений MessageContainer, для параметров - пара ``идентификатор сообщения + 
идентификатор параметра'', позволяющая также найти описание параметра в 
контейнере описания параметров ParameterContainer.

В качестве хранимых объектов используются массивы описаний ограничений, 
соответствующих каждому из типов обменов (параметров).

\subsection{Импорт описания ограничений}

За импорт файла описания протокола в tabexchange отвечают следующие классы:

\begin{itemize}
 \item BDPivImporter (файл tabexchange/mppexportimport.cpp) - класс, 
реализующий разбор XML-файла описания протокола преобразованием в представление 
QSettings, используемое в Qt-приложениях для хранения конфигурации в виде пар 
``ключ-значение'' с иерархией ключей. Объект класса заворачивается в функцию 
read(), передаваемую QSettings::registerFormat() для обобщённой обработки 
конфигурационных файлов различных форматов;.
 \item MPPExportImportModel, MPPExportImportDialog (файлы 
mppexportimport.cpp, mppexportimport.h в директории tabexchange) - классы, 
реализующие диалоговое окно импорта конфигурационного файла с возможностью 
разрешения конфликтов импорта.
\end{itemize}

В реализации анализатора ограничений были внесены следующие изменения:

\begin{itemize}
\item в класс BDPivImporter добавлена обработка XML-тегов <restrict> и 
<restricts>;
\item в метод MPPExportImportDialog::accept() добавлено заполнение контейнеров 
ExchangeRestrictionContainer и ParamRestrictionContainer в соответствии с 
описанием ограничений в загружаемом файле описания протокола.
\end{itemize}

\subsection{Контейнеры для сообщений и параметров}

В tabexchange реализованы специальные контейнеры для работы с описаниями 
сообщений и параметров:

\begin{itemize}
 \item MessageContainer,
 \item ParameterContainer.
\end{itemize}

В MessageContainer хранятся описания сообщений, в том числе шаблонные (одному 
описанию сообщения может соответствовать несколько реальных типов обменов). 
После незначительных изменений в коде контейнера он используется в реализации 
анализатора ограничений для получения внутренних идентификаторов обменов (для 
каналов MIL STD-1553B, например - командных слов обмена). Внутренние 
идентификаторы обменов используются ядром анализатора для быстрого определения 
типа полученного обмена в обработчике события \textit{addExchange()}.

В ParameterContainer хранятся описания параметров, получаемых из сообщений, а 
также производятся вычисление значений параметров при регистрации очередного 
обмена. В рамках данной работы в реализацию контейнера была добавлена рассылка 
уведомления о получении нового значения параметра (с использованием механизма 
``сигнал-слот'', реализованного в инструментарии Qt). Это уведомление 
используется ядром анализатора для запуска соответствующих обработчиков 
ограничений.

\subsection{Обработчики ограничений}

Для классов обработчиков ограничений описаны соответствующие базовые классы 
(файлы analyzercore.[cpp|h] в директории tabexchange):

\begin{itemize}
 \item AnalyzerExchangeCheckerBase,
 \item AnalyzerParamCheckerBase.
\end{itemize}

Эти классы содержат описание сигнала \textit{report()}, используемого для 
уведомления о новой строке отчёта, а также прототип чистой виртуальной функции 
\textit{check()}, принимающей в качестве аргументов:

\begin{itemize}
 \item для обменов - константный указатель на объект;
 \item для параметров - текстовый идентификатор параметра и константный 
указатель на структуру ParamValue, содержащую последнее полученное значение 
параметра и время его получения.
\end{itemize}

Все классы, реализующие обработку ограничений для обменов или параметров, 
должны наследоваться от одного из этих базовых классов.

Реализация обработчиков конкретных ограничений приводится в файлах 
analyzerfactory.[cpp|h] в директории tabexchange.

\subsection{Фабрики обработчиков ограничений}

Для создания и раздачи объектов обработчиков ограничений реализованы два класса 
фабрик объектов:

\begin{itemize}
 \item ExchangeCheckerFactory,
 \item ParamCheckerFactory.
\end{itemize}

Реализация фабрик обработчиков содержит всю логику создания новых объектов 
обработчиков и выдачи уже существующих. В частности:

\begin{itemize}
 \item ExchangeCheckerFactory содержит 
\end{itemize}

