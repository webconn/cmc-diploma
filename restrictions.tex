\subsection{Ограничения для сообщений}

\subsubsection{Частота появления сообщения}

Проверяется частота появления сообщения требуемого типа на шине.

Подсчёт частоты происходит вычислением временного интервала между получением 
текущего и предыдущего сообщений (точное время получения сообщений записано в 
структуре Exchange).

Параметры ограничения:

\begin{itemize}
 \item \textit{value} - требуемое значение частоты в герцах (Гц);
 \item maxDeviation - максимальное отклонение значения частоты (по модулю).  
Может быть записано в абсолютной величине (без суффикса; например, 1.0), так и 
в процентах (с суффиксом '\%'). По умолчанию - 5\%.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{msg_frequency} в приложении~\ref{sec:listings}.

\subsubsection{Ошибочные состояния}

Проверяются ошибочные состояния сообщения (флаги MIL STD-1553B).

Флаги описаны в структуре Exchange.

Параметров у ограничения нет.

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{msg_errors} в приложении~\ref{sec:listings}.


\subsubsection{Последовательность сообщений}

Проверяется последовательность сообщений.

Последовательность сообщений задаётся с помощью идентификатора 
последовательности. Каждое сообщение, входящее в последовательность, имеет в 
ней порядковый номер. Анализатор проверяет, соблюдается ли порядок появления 
сообщений в канале согласно порядку номеров.

Стоит заметить, что сообщения не обязательно должны следовать друг за другом; 
между сообщениями одной последовательности могут появляться другие сообщения. 
Проверяется порядок именно тех сообщений, которые включены в последовательность.

В параметрах ограничения описывается строковой идентификатор последовательности 
(идентификатор Си) и номер сообщения в последовательности. 

Если после анализа файла протокола выяснится, что номера каких-либо сообщений в 
последовательности совпадают, пользователь получит сообщение об ошибке и 
ограничение проверяться не будет. Последовательность пар \textit{(номер, 
тип\_сообщения)} будет упорядочена по номеру.

При получении первого сообщения за время работы анализатор выставит внутренний
индекс на номер полученного сообщения. При получении следующего, анализатор
сравнит номер следующего полученного сообщения со следующим сообщением в 
последовательности. При несовпадении будет выведено сообщение об ошибке,
при этом внутренний индекс вновь будет сброшен.

Параметры ограничения:

\begin{itemize}
 \item sequenceId - идентификатор последовательности (строка - идентификатор 
Си);
 \item order - номер сообщения в последовательности.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{msg_sequence} в приложении~\ref{sec:listings}.

В случае несовпадения параметра level у описаний одной и той же 
последовательности, пользователь получит предупреждение, при этом будет выбрано 
самое сильное значение параметра.

\subsubsection{Значение контрольной суммы в полезной нагрузке}

Проверяется значение контрольной суммы для некоторого диапазона байт в полезной 
нагрузке сообщения.

Подразумевается, что в полезной нагрузке сообщения можно специально выделить 
две последовательности байт, где одна из них - блок данных, а вторая - значение 
контрольной суммы для этого блока данных.

Параметры ограничения:

\begin{itemize}
 \item function - функция подсчёта контрольной суммы (crc16 в данной 
реализации);
 \item dataStart - номер первого слова последовательности блока данных;
 \item dataSize - длина последовательности блока данных (количество слов);
 \item checksumWord - номер слова поля контрольной суммы. 
Подразумевается, что длина поля контрольной суммы известна по функции подсчёта.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{msg_crc} в приложении~\ref{sec:listings}.

\subsection{Ограничения для параметров}
\label{subsec:param_restricts}

\subsubsection{Частота обновления параметра}

Проверяется минимальная частота обновления значения параметра.

Подсчёт частоты происходит вычислением временного интервала между получением 
текущего и предыдущего сообщений. Точное время получения значения
параметра передаётся вместе со значением в структуре 
ParameterContainer::ParamValue.

Параметры ограничения:

\begin{itemize}
 \item \textit{value} - требуемое минимальное значение частоты в герцах (Гц);
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_frequency} в приложении~\ref{sec:listings}.

\subsubsection{Пороговые значения}

Проверяется выход значения параметра за некоторое пороговое значение (вверх или 
вниз).

Для одного параметра можно описать несколько различных пороговых значений (в 
том числе одного типа) при том, что у ограничений будут различаться уровни 
критичности (параметры level). В случае, если значение параметра вышло за 
несколько пороговых значений одного типа (min или max), сообщение будет 
выведено для порогового значения с самым сильным значением уровня критичности.

Типы ограничений:

\begin{itemize}
 \item min - минимальное значение параметра;
 \item max - максимальное значение параметра.
\end{itemize}

Параметры ограничения:

\begin{itemize}
 \item \textit{value} - пороговое значение.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_thresholds} в приложении~\ref{sec:listings}.


\subsubsection{Равенство константе}

Проверяется равенство значения параметра константе (или равенство 
с допустимой погрешностью).

Параметры ограничения:
\begin{itemize}
 \item \textit{value} - константа,
 \item maxDeviation - максимальное отклонение значения от константы в 
абсолютной величине (по модулю). По умолчанию - 0.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_const} в приложении~\ref{sec:listings}.


\subsubsection{Ошибочное значение}

Проверяется равенство значения параметра константе, означающей 
ошибочное состояние параметра. Значение должно быть целочисленным.

Параметры ограничения:
\begin{itemize}
 \item \textit{value} - ошибочное значение.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_errorvalue} в приложении~\ref{sec:listings}.


\subsubsection{Гладкость}

Проверяется гладкость параметра - ограничение на максимальную (по модулю) 
скорость изменения значения параметра.

Скорость изменения параметра измеряется в единицах измерения значения параметра 
в секунду и считается между двумя соседними событиями обновления значения 
параметра по формуле:

$
v = \frac{val_2 - val_1}{t_2 - t_1},
$

где $v$ - скорость изменения значения параметра, $val_2, val_1$ - 
соответственно текущее и предыдущее значения наблюдаемого параметра, $t_2, t_1$ 
- время получения текущего и предыдущего значения параметра соответственно (в 
секундах с момента начала записи трассы).

Параметры ограничения:
\begin{itemize}
 \item \textit{value} - максимальное значение скорости изменения параметра (по 
модулю).
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_smooth} в приложении~\ref{sec:listings}.


\subsubsection{Связанные параметры}

Проверяется соответствие значений нескольких различных параметров, имеющих 
общую природу.

Например, высота над уровнем моря на борту самолёта может быть получена от 
модуля позиционирования, использующего GPS, и от модуля, использующего 
барометрический датчик. Каждый модуль предлагает свой собственный параметр, 
требуется сравнить эти параметры с заранее заданной погрешностью.

%TODO
Параметры связываются в группы, определённые с помощью 
строковых идентификаторов групп. Для каждого отдельного 
параметра устанавливается максимальная погрешность измерений (в абсолютной или 
относительной величине), а также ``время жизни'' - интервал времени, в течение 
которого значение параметра считается валидным.

При получении нового значения параметра, включённого в группу, происходят 
следующие действия:

\begin{enumerate}
 \item Значение параметра и время получения этого значения вносятся в таблицу 
значений группы;
 \item Определяются все ``живые'' значения параметров из группы (те значения, 
для времени 
получения которых верно: $t_{now} \leq t_{recv} + timeout$);
 \item Вычисляются абсолютные значения погрешностей для каждого параметра 
группы;
 \item Строится множество отрезков, заданных центральной точкой (значением 
параметра) и радиусом (величиной погрешности);
 \item Строится пересечение полученных отрезков. Если пересечение отрезков 
пусто - ограничение нарушено.
\end{enumerate}

Параметры ограничения:
\begin{itemize}
 \item group - идентификатор группы связанных параметров (строка - 
идентификатор Си);
 \item measureError - допустимая ошибка измерения параметра. Может быть 
записана в абсолютной величине (без суффикса) или относительной величине (с 
суффиксом '\%');
 \item timeout - время жизни последнего полученного значения.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_groups} в приложении~\ref{sec:listings}.

В случае несовпадения параметра level у описаний одной и той же 
группы связанных параметров, пользователь получит предупреждение, при этом 
будет выбрано самое сильное значение параметра.

\subsubsection{Автоинкремент значения параметра}

Автоинкремент - свойство целочисленного значения параметра 
увеличиваться на 1 с заданной частотой. Такие параметры могут 
использоваться для проверки работоспособности модуля абонента.

Проверяется соблюдение свойства автоинкремента значения параметра.

Параметры ограничения:
\begin{itemize}
 \item timeout - длина максимального временного интервала, в течение которого 
значение параметра может оставаться неизменным.
\end{itemize}

Пример описания ограничения в файле протокола приведён в 
листинге~\ref{param_autoinc} в приложении~\ref{sec:listings}.